<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleag.org">
<head>
    <link rel="icon" href="/image/logo.png"/>
    <link rel="stylesheet" href="/css/adminpage.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>관리자 페이지 - 보안셀</title>
</head>
<body>
<!-- Header -->
<header class="main-header">
    <div class="header-left">
        <div class="toggle-switch">
            <input type="checkbox" id="darkModeToggle" class="checkbox">
            <label for="darkModeToggle" class="label">
                <i class="fas fa-moon"></i>
                <i class="fas fa-sun"></i>
                <div class="ball"></div>
            </label>
        </div>
    </div>
    
    <div class="header-center">
        <a class="logo-link" href="/">
            <img src="/image/logo.png" alt="보안셀 로고">
        </a>
    </div>
    
    <div class="header-right">
        <div class="admin-info" id="log-out">
            <i class="fas fa-user-shield"></i>
            <p th:utext="${member.memberName}+ ' 관리자님, 반갑습니다!'" id="logout-text"></p>
        </div>
    </div>
    
    <div class="page-title">
        <h1><i class="fas fa-cog"></i> 관리자 페이지</h1>
    </div>
</header>

<!-- Main Content -->
<main class="main-content">
    <!-- Member Management Section -->
    <section class="member-section">
        <div class="member-card">
            <div class="card-header">
                <h2><i class="fas fa-users"></i> 회원정보</h2>
                <div class="admin-actions" th:if="${member.memberType.toString() == 'SUPERADMIN'}">
                    <button id="delete-member-btn" class="btn btn-danger">
                        <i class="fas fa-user-minus"></i> 회원 삭제
                    </button>
                    <button class="btn btn-warning">
                        <i class="fas fa-user-cog"></i> 관리자 전환
                    </button>
                    <button class="btn btn-info">
                        <i class="fas fa-exchange-alt"></i> 팀 전환
                    </button>
                </div>
            </div>
            
            <div class="table-container">
                <table class="member-table" id="member-table">
                    <thead>
                        <tr>
                            <th>
                                <input name="members" value="selectAll" onclick="selectAll(this)" type="checkbox" 
                                       th:if="${member.memberType.toString() == 'SUPERADMIN'}">
                            </th>
                            <th>이름</th>
                            <th>소속 팀</th>
                            <th>회원구분</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="empty-row" th:if="${memberList.isEmpty()}">
                            <td colspan="4">
                                <div class="empty-state">
                                    <i class="fas fa-users"></i>
                                    <p>등록된 멤버가 없습니다.</p>
                                </div>
                            </td>
                        </tr>
                        <tr class="member-row" th:each="memberEt, iterStat : ${memberList}" 
                            th:class="${iterStat.count > 5} ? 'hidden-member' : ''">
                            <td>
                                <input th:value="${memberEt.id}" name="members" type="checkbox" 
                                       th:if="${member.memberType.toString() == 'SUPERADMIN'}">
                            </td>
                            <td th:text="${memberEt.memberName}">이름</td>
                            <td class="team-cell" th:attr="data-member-id=${memberEt.id}" 
                                th:text="${memberEt.memberTeamNum}+'팀'">팀</td>
                            <td>
                                <span class="member-type" th:if="${memberEt.memberType.toString() == 'NORMAL'}">일반</span>
                                <span class="member-type admin" th:if="${memberEt.memberType.toString() == 'ADMIN'}">팀장</span>
                                <span class="member-type superadmin" th:if="${memberEt.memberType.toString() == 'SUPERADMIN'}">셀장</span>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <button class="btn btn-outline show-more-btn" id="show-more-btn" onclick="showMore()">
                    <i class="fas fa-chevron-down"></i> 더보기
                </button>
            </div>
        </div>
    </section>

    <!-- Attendance Management Section -->
    <section class="attendance-section">
        <div class="attendance-card">
            <div class="card-header">
                <h2><i class="fas fa-clock"></i> 출근정보</h2>
                <div class="attendance-filters">
                    <form class="filter-form" id="attendanceForm" action="/admin/adminpage" method="GET">
                        <div class="filter-group">
                            <button type="button" class="btn btn-secondary" id="todayButton">
                                <i class="fas fa-calendar-day"></i> 오늘
                            </button>
                        </div>
                        
                        <div class="filter-group">
                            <label for="date-start">시작일:</label>
                            <input type="date" name="from" id="date-start">
                        </div>
                        
                        <div class="filter-group">
                            <label for="date-end">종료일:</label>
                            <input type="date" name="to" id="date-end">
                        </div>
                        
                        <div class="filter-group">
                            <div id="myDropdown" class="dropdown-container">
                                <button type="button" class="btn btn-secondary dropdown-toggle" id="dropdownToggle">
                                    <i class="fas fa-user-friends"></i> 팀원 선택
                                </button>
                                <div class="dropdown-content">
                                    <div class="dropdown-header">
                                        <span>팀원을 선택하세요</span>
                                    </div>
                                    <div class="member-list">
                                        <div th:each="memberList, iterStat : ${memberList}">
                                            <a href="#" class="team-member" th:data-value="${memberList.id}" 
                                               th:text="${memberList.memberName}">이름</a>
                                        </div>
                                    </div>
                                    <div class="dropdown-actions">
                                        <button type="button" id="deselect-dropdown" class="btn btn-outline">
                                            <i class="fas fa-times"></i> 선택 해제
                                        </button>
                                        <button type="button" id="close-dropdown" class="btn btn-primary">
                                            <i class="fas fa-check"></i> 확인
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="filter-group">
                            <button type="submit" class="btn btn-primary" id="searchButton">
                                <i class="fas fa-search"></i> 조회
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            
            <div class="table-container">
                <table class="attendance-table">
                    <thead>
                        <tr>
                            <th onclick="sortTable(this, 0)">
                                이름 <span class="sort-icon">&#8597;</span>
                            </th>
                            <th onclick="sortTable(this, 1)">
                                소속 팀 <span class="sort-icon">&#8597;</span>
                            </th>
                            <th onclick="sortTable(this, 2)">
                                날짜 <span class="sort-icon">&#8597;</span>
                            </th>
                            <th>출근 시간</th>
                            <th>퇴근 시간</th>
                        </tr>
                    </thead>
                    <tbody id="attendanceTableBody">
                        <tr class="empty-row" th:if="${attendanceList.isEmpty()}">
                            <td colspan="5">
                                <div class="empty-state">
                                    <i class="fas fa-clock"></i>
                                    <p>출근한 인원이 없습니다.</p>
                                </div>
                            </td>
                        </tr>
                        <tr class="attendance-row" th:each="attendanceList : ${attendanceList}">
                            <td th:text="${attendanceList.memberName}">홍길동</td>
                            <td th:text="${attendanceList.memberTeamNum}">1팀</td>
                            <td th:text="${attendanceList.formattedCheckOutDate}">n월 n일</td>
                            <td th:text="${attendanceList.formattedCheckInTime}">17:00:00</td>
                            <td th:text="${attendanceList.formattedCheckOutTime}">19:00:00</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>
</main>

<!-- No Work Management Section -->
<section class="no-work-section">
    <div class="no-work-card">
        <div class="card-header">
            <h2><i class="fas fa-file-alt"></i> 미출근 사유 관리</h2>
            <div class="no-work-actions">
                <button id="noWork-YesBtn" class="btn btn-success" onclick="OkToNoWork()">
                    <i class="fas fa-check"></i> 승인
                </button>
                <button id="noWork-NoBtn" class="btn btn-danger" onclick="NotOkToNoWork()">
                    <i class="fas fa-times"></i> 거절
                </button>
            </div>
        </div>
        
        <div class="table-container">
            <table class="no-work-table">
                <thead>
                    <tr>
                        <th>
                            <input name="noWorks" value="selectAll" onclick="selectAllNoWork(this)" type="checkbox">
                        </th>
                        <th>처리상태</th>
                        <th>작성날짜</th>
                        <th>이름</th>
                        <th>범주</th>
                        <th>세부 내용</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="empty-row" th:if="${noWorkList.isEmpty()}">
                        <td colspan="6">
                            <div class="empty-state">
                                <i class="fas fa-inbox"></i>
                                <p>미출근 사유 신청서가 없습니다.</p>
                            </div>
                        </td>
                    </tr>
                    <tr class="no-work-row" th:each="noWorkList, iterStat : ${noWorkList}" 
                        th:class="${iterStat.count > 5} ? 'hidden-noWork' : ''">
                        <td>
                            <input th:value="${noWorkList.id}" name="noWorks" type="checkbox">
                        </td>
                        <td>
                            <span class="status-badge" th:if="${noWorkList.status.toString() == 'WAITING'}" 
                                  th:id="${noWorkList.id}">대기</span>
                            <span class="status-badge approved" th:if="${noWorkList.status.toString() == 'ABLE'}" 
                                  th:id="${noWorkList.id}">승인</span>
                            <span class="status-badge rejected" th:if="${noWorkList.status.toString() == 'UNABLE'}" 
                                  th:id="${noWorkList.id}">거절</span>
                        </td>
                        <td th:text="${noWorkList.selectedDate}">작성일</td>
                        <td th:text="${noWorkList.memberName}">이름</td>
                        <td th:text="${noWorkList.category}">알바</td>
                        <td th:text="${noWorkList.detail}">디테일</td>
                    </tr>
                </tbody>
            </table>
            <button class="btn btn-outline show-more-btn" id="noWork-show-more-btn" onclick="showMoreNoWork()"
                    th:if="${noWorkList != null && noWorkList.size() > 5}">
                <i class="fas fa-chevron-down"></i> 더보기
            </button>
        </div>
    </div>
</section>

<!-- Confirm Modal -->
<div id="confirmModal" class="confirm-modal">
    <div class="confirm-modal-content">
        <div class="confirm-header">
            <i class="fas fa-question-circle"></i>
            <h3>확인</h3>
        </div>
        <div class="confirm-body">
            <p id="confirmModalMessage"></p>
        </div>
        <div class="confirm-footer">
            <button class="btn btn-secondary" onclick="handleConfirm(false)">
                <i class="fas fa-times"></i> 취소
            </button>
            <button class="btn btn-primary" onclick="handleConfirm(true)">
                <i class="fas fa-check"></i> 확인
            </button>
        </div>
    </div>
</div>

<!-- Alert Modal -->
<div id="reusableModal" class="alert-modal">
    <div class="alert-modal-content">
        <button class="alert-close" id="reusable-modal-close">
            <i class="fas fa-times"></i>
        </button>
        <div class="alert-message">
            <i class="fas fa-info-circle"></i>
            <p id="reusableModalMessage"></p>
        </div>
    </div>
</div>

<!-- Attendance Time Modal -->
<div id="attendance-modal" class="attendance-modal">
    <div class="attendance-modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-clock"></i> 출근시간 조정</h3>
            <button class="modal-close" onclick="closeAttendanceModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="modal-body">
            <form class="attendance-form">
                <div class="form-group">
                    <label for="startDate">
                        <i class="fas fa-calendar"></i> 시작 날짜
                    </label>
                    <input id="startDate" type="date" name="startDate" required>
                </div>
                
                <div class="form-group">
                    <label for="endDate">
                        <i class="fas fa-calendar"></i> 종료 날짜
                    </label>
                    <input id="endDate" type="date" name="endDate" required>
                </div>
                
                <div class="form-group">
                    <label>
                        <i class="fas fa-calendar-week"></i> 요일 선택
                    </label>
                    <div class="weekday-options">
                        <label class="weekday-option">
                            <input type="checkbox" name="weekday" value="월">
                            <span>월</span>
                        </label>
                        <label class="weekday-option">
                            <input type="checkbox" name="weekday" value="화">
                            <span>화</span>
                        </label>
                        <label class="weekday-option">
                            <input type="checkbox" name="weekday" value="수">
                            <span>수</span>
                        </label>
                        <label class="weekday-option">
                            <input type="checkbox" name="weekday" value="목">
                            <span>목</span>
                        </label>
                        <label class="weekday-option">
                            <input type="checkbox" name="weekday" value="금">
                            <span>금</span>
                        </label>
                        <label class="weekday-option">
                            <input type="checkbox" name="weekday" value="토">
                            <span>토</span>
                        </label>
                        <label class="weekday-option">
                            <input type="checkbox" name="weekday" value="일">
                            <span>일</span>
                        </label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="startTime">
                        <i class="fas fa-clock"></i> 출근 시간
                    </label>
                    <input id="startTime" type="time" name="startTime" required>
                </div>
            </form>
        </div>
        
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="closeAttendanceModal()">
                <i class="fas fa-times"></i> 취소
            </button>
            <button type="button" class="btn btn-primary" onclick="handleAttendanceFormSubmit()">
                <i class="fas fa-save"></i> 저장
            </button>
        </div>
    </div>
</div>

<!-- Scripts -->
<script src="/js/admin.js"></script>
<script type="application/javascript" th:inline="javascript">
    let member = [[${member}]];
    let noWorkList = [[${noWorkList}]];
    let memberList = [[${memberList}]];
    let attendanceList = [[${attendanceList}]];
</script>
</body>
</html>